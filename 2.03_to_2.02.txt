//msg "Make sure you run this at the starting entry point"

//Start at PUSHH
run
//Clear any existing breakpoints
bc
bphwc

//Find the OEP
find CIP, E91B33FFFF// Signature of OEP jump
cmp $result, 0	// Check for success
je error	// Error otherwise
bp $result	// Set a breakpoint on the jump
run	// Continue execution to the jump
st	// Take the jump to the second jump
st	// Take jump to OEP
ret	// Return to user


error:
msg "Could not find the OEP."
msg "How to find the OEP:"
msg "Begin at the entry point of the application"
msg "Hit run to get to the PUSHAD"
msg "Scroll through the large set of loops which follow."
msg "After the loops, a couple of jump instructions will be found."
msg "Break point them and one of them should lead to the OEP."
msg "If you hit a block of dd opcodes, you've gone too far."
ret